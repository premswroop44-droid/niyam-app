<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Niyam App</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<link rel="manifest" href="manifest.json">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#4f46e5">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Niyam App">


<style>
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:#eef2f7;
  display:flex;
  justify-content:center;
}
.app{
  max-width:390px;
  width:100%;
  padding:20px;
  text-align:center;
}
.wallet{
  background:#fff;
  padding:12px;
  border-radius:12px;
  font-weight:600;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
  margin-bottom:15px;
}
.card{
  background:#fff;
  border-radius:16px;
  padding:18px;
  margin-bottom:15px;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
}
.title{font-size:18px;font-weight:600;}
.time{font-size:14px;color:#666;margin:6px 0;}
button{
  width:100%;
  padding:11px;
  border:none;
  border-radius:10px;
  background:#4f46e5;
  color:#fff;
  margin-top:8px;
  cursor:pointer;
}
button.red{background:#ef4444;}
button.green{background:#16a34a;}
button:disabled{background:#aaa;}
.msg{margin-top:8px;font-weight:600;}
.toggle{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-bottom:15px;
}
#reviewOverlay{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.6);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:9999;
}

#reviewBox{
  background:#fff;
  width:300px;
  padding:20px;
  border-radius:14px;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,0.3);
}

.reviewBtns{
  display:flex;
  gap:10px;
  margin-top:20px;
}

.reviewBtns button{
  flex:1;
  padding:10px;
  border:none;
  border-radius:10px;
  font-size:15px;
  cursor:pointer;
}

.reviewBtns .yes{
  background:#16a34a;
  color:white;
}

.reviewBtns .no{
  background:#dc2626;
  color:white;
}
#calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:5px;
  margin-top:10px;
}

.day{
  border:1px solid #ddd;
  border-radius:6px;
  padding:5px;
  font-size:11px;
  background:#f9fafb;
}

.day strong{
  display:block;
  font-size:12px;
  margin-bottom:3px;
}

.done{ color:green; }
.skip{ color:red; }
/* ===============================
   MOBILE FIX (PHONE VIEW)
================================ */
@media (max-width: 600px){

  body{
    font-size:14px;
  }

  .app-container{
    padding:10px;
  }

  .main-layout{
    display:block;   /* desktop grid hat jaayega */
  }

  .controls,
  .reports{
    width:100%;
  }

  .card{
    margin-bottom:12px;
  }

  button{
    width:100%;      /* buttons full-width */
    font-size:15px;
  }

  .wallet{
    font-size:16px;
  }

  #calendar{
    grid-template-columns: repeat(7, 1fr);
    gap:4px;
  }

  .day{
    font-size:10px;
    min-height:70px;
  }
}
/* ===== MOBILE FIX ===== */
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  overflow-x: hidden;   /* ğŸ‘ˆ sabse important */
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
}
/* ===== PHONE VIEW ===== */
@media (max-width: 768px){

  .main-layout,
  .container,
  .dashboard {
    display: block !important;  /* ek ke niche ek */
    width: 100%;
  }

  .card {
    width: 100%;
    margin: 10px 0;
    box-sizing: border-box;
  }

  button {
    width: 100%;
    font-size: 16px;
  }

  img, svg, i {
    max-width: 100%;
    height: auto;
  }

}
/* ===== FINAL MOBILE + DESKTOP FIX ===== */

* {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow-x: hidden;   /* ğŸ”¥ horizontal scroll kill */
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
}

#app-root {
  width: 100%;
  max-width: 100vw;     /* ğŸ”¥ important */
  padding: 10px;
}

/* Main layout */
.main-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  width: 100%;
}

/* Cards */
.card {
  width: 100%;
  max-width: 100%;
  overflow: hidden;
}

/* Monthly report calendar */
#calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  width: 100%;
}

#calendar button,
#calendar div {
  width: 100%;
  min-width: 0;
}

/* Buttons */
button {
  width: 100%;
  max-width: 100%;
}

/* ===== PHONE VIEW ===== */
@media (max-width: 768px){

  .main-layout {
    grid-template-columns: 1fr;  /* ğŸ”¥ ek ke niche ek */
  }

  #calendar {
    grid-template-columns: repeat(7, 1fr);
  }

}
body {
  max-width: 100vw;
  overflow-x: hidden;
  touch-action: manipulation;
}
@media screen and (max-width: 1000px) {
  * {
    max-width: 100% !important;
  }
}
/* ===== ENTRY POPUP (FULL PAGE FEEL) ===== */

.entry-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.55);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.entry-popup {
  background: #ffffff;
  width: 100%;
  max-width: 420px;
  height: 90vh;              /* ğŸ”¥ height badi */
  border-radius: 18px;
  padding: 25px;
  box-shadow: 0 15px 30px rgba(0,0,0,0.25);
  display: flex;
  flex-direction: column;
  justify-content: center;
  text-align: center;
}

.entry-popup h2 {
  margin-bottom: 8px;
}

.entry-popup p {
  color: #666;
  font-size: 14px;
  margin-bottom: 25px;
}

.entry-popup input {
  width: 100%;
  padding: 14px;
  margin-bottom: 16px;
  font-size: 16px;
  border-radius: 12px;
  border: 1px solid #ccc;
}

.entry-popup input:focus {
  outline: none;
  border-color: #4facfe;
}

.entry-popup button {
  margin-top: 10px;
  padding: 14px;
  font-size: 17px;
  border-radius: 14px;
  border: none;
  background: #4facfe;
  color: white;
  font-weight: bold;
}
/* ========= MOBILE MODE (â‰¤ 400px) ========= */
@media (max-width: 400px){

  /* poora layout ek column */
  .main-layout,
  .dashboard,
  .container,
  .row {
    display: block !important;
    width: 100% !important;
  }

  /* side panels hide */
  .right-panel,
  .monthly-panel,
  .storage-panel {
    display: none !important;
  }

  /* cards full width */
  .card {
    width: 100% !important;
    margin: 10px 0 !important;
  }

  /* buttons mobile friendly */
  button {
    width: 100% !important;
    font-size: 16px;
  }

  /* header center */
  header,
  .header {
    text-align: center;
  }

}
.btn-mobile {
  display: none;
  margin: 10px 0;
  padding: 12px;
  border-radius: 12px;
  background: #4facfe;
  color: white;
  font-size: 16px;
  border: none;
}

/* mobile me hi dikhe */
@media (max-width: 400px){
  .btn-mobile {
    display: block;
  }
}
/* ========= FORCE MOBILE HIDE (â‰¤ 400px) ========= */
@media (max-width: 400px){


}
@media (max-width: 400px){

  button {
    width: auto !important;     /* ğŸ”¥ full width band */
    min-width: 160px;
    padding: 10px 16px;
    font-size: 14px;
    border-radius: 10px;
    display: block;
    margin: 8px auto;           /* center */
  }

}
/* ===== MOBILE HARD FIX ===== */
@media (max-width: 400px){

  body {
    overflow-x: hidden;
  }

  

  /* Layout collapse to single column */
  .main-layout {
    display: block !important;
    width: 100% !important;
  }
}
/* ===== FORCE SCROLL FIX ===== */
html, body {
  height: auto !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
}

/* cards ke andar bhi scroll allow */
.card {
  overflow: visible !important;
}
/* overlay click block fix */
.entry-overlay[style*="display: none"],
#parentPopup[style*="display: none"] {
  pointer-events: none;
}
.entry-overlay,
#parentPopup {
  pointer-events: auto;
}
/* ===== Parent section always visible ===== */
#parentSection,
.parent-section {
  display: block !important;
}
@media (max-width: 420px) {

  .main-layout {
    display: flex !important;
    flex-direction: column !important;
    width: 100%;
  }


  /* buttons normal size */
  button {
    width: auto;
    min-width: 140px;
    margin: 8px auto;
  }
}
/* ===== FORCE LEADERBOARD SHOW ===== */
#leaderboard {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  position: relative;
  z-index: 1;
}
html, body {
  overflow-x: hidden;
  overflow-y: auto;
}
/* ===== POPUP OVERLAY ===== */
.popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.45);
  display: none;              /* ğŸ”¥ by default hidden */
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

/* popup card */
.popup-card {
  width: 90%;
  max-width: 400px;
  height: 90vh;               /* page feel */
  background: white;
  border-radius: 18px;
  padding: 24px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

/* inputs */
.popup-card input {
  margin-bottom: 14px;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid #ccc;
}

/* button */
.popup-card button {
  margin-top: 10px;
  padding: 14px;
  border-radius: 12px;
  border: none;
  background: #4facfe;
  color: #fff;
}

/* SCROLL FIX */
html, body {
  overflow-y: auto !important;
}
/* ===== PARENT REVIEW POPUP â€“ MOBILE FIX ===== */

#parentPopup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.55);
  display: none;              /* JS se control */
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

/* actual popup card */
#parentPopup > div {
  background: #fff;
  width: 92%;
  max-width: 420px;
  max-height: 85vh;
  margin: 0 auto;             /* ğŸ”¥ center fix */
  padding: 18px;
  border-radius: 16px;
  box-shadow: 0 15px 30px rgba(0,0,0,0.25);
  overflow-y: auto;           /* scroll inside popup */
}

/* buttons inside popup */
#parentPopup button {
  width: 100%;
  margin-top: 10px;
  padding: 12px;
  border-radius: 12px;
  font-size: 15px;
}
/* ===== PIN REMINDER POPUP ===== */
#pinReminderPopup{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

.pin-reminder-card{
  background: #fff;
  width: 90%;
  max-width: 420px;
  padding: 22px;
  border-radius: 18px;
  text-align: center;
  box-shadow: 0 20px 40px rgba(0,0,0,.3);
}

.pin-reminder-card h2{
  margin-bottom: 10px;
  font-size: 22px;
}

.pin-reminder-card p{
  font-size: 16px;
  line-height: 1.5;
  margin-bottom: 18px;
}

.pin-reminder-card button{
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  border-radius: 10px;
  font-size: 15px;
}
/* Parent Review Popup */
#parentPopup{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

.parent-review-card{
  background: #fff;
  width: 90%;
  max-width: 420px;
  border-radius: 18px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 20px 40px rgba(0,0,0,.3);
}

.parent-review-card h2{
  margin-bottom: 12px;
}

.review-task{
  font-size: 16px;
  margin: 16px 0;
}

.review-actions{
  display: flex;
  gap: 12px;
}

.review-actions button{
  flex: 1;
  padding: 12px;
  font-size: 15px;
  border-radius: 10px;
}
/* ===== COMMON POPUP OVERLAY ===== */
.popup-overlay{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.65);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

/* ===== POPUP OVERLAY ===== */
.popup-overlay{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 99999;
}

/* ===== POPUP CARD ===== */
.parent-review-card{
  background: #fff;
  width: 90%;
  max-width: 420px;
  max-height: 80vh;          /* ğŸ”‘ MOST IMPORTANT */
  border-radius: 18px;
  padding: 18px;
  text-align: center;
  box-shadow: 0 25px 50px rgba(0,0,0,.35);
  overflow: hidden;          /* ğŸ”‘ NO SCROLL INSIDE */
}

/* title */
.parent-review-card h2{
  margin-bottom: 16px;
}

/* task text */
.review-task{
  font-size: 16px;
  margin: 14px 0 22px;
  line-height: 1.4;
  word-wrap: break-word;
}

/* buttons row */
.review-actions{
  display: flex;
  gap: 12px;
}

/* buttons */
.review-actions button{
  flex: 1;
  padding: 14px;
  font-size: 16px;
  border-radius: 12px;
  border: none;
}

.btn-yes{
  background: #16a34a;
  color: #fff;
}

.btn-no{
  background: #dc2626;
  color: #fff;
}


</style>
</head>

<body>


<div class="app">

<h2>ğŸ“± Niyam App</h2>

<div id="scoreBox" class="card">
  â­ Score: 0
</div>
<div class="card">
  <h3>ğŸ† Leaderboard</h3>
  <ul id="leaderboard"></ul>
</div>

<!-- ğŸ” Parent Review Button -->

<div class="card">
  <div class="title">ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ Parent Section</div>

  <button onclick="parentReview()">ğŸ” Parent Daily Review</button>

  <button onclick="changeParentPin()">
    ğŸ” Change Parent PIN
  </button>

  <div class="time">(Sirf parent ke liye)</div>
</div>

<!-- ğŸŒ… SUBAH JALDI UTHNA -->
<div class="card">
<div class="title">ğŸŒ… Subah Jaldi Uthna</div>
<div class="time">(Allowed: 4:00 â€“ 5:00 AM)</div>
<button onclick="doneWakeUp()">âœ” Tick</button>
<div class="msg" id="wakeMsg"></div>
<button class="red" onclick="skipTask('wakeMsg','exStartBtn')">âŒ Nahi Kiya</button>
</div>

<!-- ğŸƒ EXERCISE -->
<div class="card">
<div class="title">ğŸƒ Exercise</div>
<div class="time">(30 minute compulsory)</div>

<div id="exTimer">â³ 30:00</div>
<button onclick="startExercise()">â–¶ï¸ Start</button>
<button class="red" onclick="stopExercise()">â¸ï¸ Stop</button>
<button id="exTick" onclick="doneExercise()" disabled>âœ” Tick</button>
<div class="msg" id="exMsg"></div>
<button class="red"
  onclick="skipTask('exMsg','bathBtn')">
âŒ Nahi Kiya
</button>
</button>
</div>

<!-- ğŸš¿ NAHANA -->
<div class="card">
<div class="title">ğŸš¿ Nahana</div>
<button id="bathBtn" onclick="doneBath()" disabled>âœ” Tick</button>
<div class="msg" id="bathMsg"></div>
<button class="red"
  onclick="skipTask('bathMsg','pranBtn')">
âŒ Nahi Kiya
</button>
</div>

<!-- ğŸ§˜ PRANAYAMA -->
<div class="card">
<div class="title">ğŸ§˜ Pranayama</div>
<div class="time">(Allowed:before 5:00 AM)</div>
<button id="pranBtn" onclick="donePran()" disabled>âœ” Tick</button>
<div class="msg" id="pranMsg"></div>
<button class="red"
  onclick="skipTask('pranMsg','malaBtn')">
âŒ Nahi Kiya
</button>
</div>

<!-- ğŸ“¿ MALA -->
<div class="card">
<div class="title">ğŸ“¿ 11 Mala Jap</div>
<button id="malaBtn" onclick="doneMala()" disabled>âœ” Tick</button>
<div class="msg" id="malaMsg"></div>
<button class="red"
  onclick="skipTask('malaMsg','schoolBtn')">
âŒ Nahi Kiya
</button>
</div>

<!-- ğŸ“¿ MALA -->
<div class="card">
<div class="title">satsang sunna</div>
<button onclick="doneSatsang()">âœ” Tick</button>
<div class="msg" id="malaMsg"></div>
<button class="red"
  onclick="skipTask('doneSatsang','schoolBtn')">
âŒ Nahi Kiya
</button>
</div>


<!-- monun-->
<div class="card">
  <h3>ğŸ¤« Moun (Chup Rahna)</h3>

  <div id="mounTimer">â³ 60:00</div>

  <button id="mounStart" onclick="startMoun()">
    â–¶ Start Moun
  </button>

  <button id="mounDone" onclick="doneMoun()" disabled>
    âœ” Moun Complete
  </button>

  <div id="mounMsg"></div>
</div>




</div>
<!-- ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Parent Review Popup -->
<div id="parentPopup" class="popup-overlay" style="display:none;">
  <div class="parent-review-card">

    <h2>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Parent Review</h2>

    <div id="reviewTaskText" class="review-task"></div>

    <div class="review-actions">
      <button class="btn-yes" onclick="approveCurrent()">âœ” Haan</button>
      <button class="btn-no" onclick="rejectCurrent()">âŒ Nahi</button>
    </div>

  </div>
</div>

  <div id="entryPopup" class="entry-overlay" style="display:none">
  <div class="popup-card">
    <h2>ğŸ‘‹ Welcome</h2>
    <p>Apni basic details bhare</p>

    <input id="userNameInput" placeholder="Full Name">
    <input id="userAgeInput" placeholder="Age">
    <input id="userPhoneInput" placeholder="Phone Number">

    <button onclick="saveUserName()">Continue</button>
  </div>
</div>
</div>

</div>
  <!-- ğŸ”” FIRST TIME PARENT PIN REMINDER -->
<div id="pinReminderPopup" style="display:none;">
  <div class="pin-reminder-card">
    <h2>ğŸ™ karipya apna ek pin banaye</h2>
    <p>
      Kripya <b>Mata ya Pita</b> apna  
      <b>Parent PIN</b> banaye  
      taaki bacche ki daily activity  
      surakshit rahe ğŸ™
    </p>
    <button onclick="openPinSetup()">ğŸ” PIN Banaye</button>
    <button onclick="closePinReminder()">Baad me</button>
  </div>
</div>

<!-- ğŸ” PARENT PIN SETUP -->
<div id="changePinPopup" style="display:none;">
  <div class="pin-reminder-card">
    <h2>ğŸ” Parent PIN Set Kare</h2>
    <p>Kripya 4 digit ka PIN dale</p>

    <input
      type="password"
      id="newParentPin"
      placeholder="Enter Parent PIN"
      maxlength="4"
      style="width:100%;padding:10px;font-size:16px;"
    />

    <button onclick="saveParentPin()">âœ… Save PIN</button>
    <button onclick="closePinSetup()">âŒ Cancel</button>
  </div>
</div>

<script>
  /*************************************************
 * NIYAM APP â€“ FULL FINAL JS
 *************************************************/

/* ========== CONFIG ========== */
const DEFAULT_PARENT_PIN = "1234";

/* ========== GLOBALS ========== */
let currentUser = null;
let pendingTasks = [];
let reviewIndex = 0;

/* ========== STORAGE HELPERS ========== */
function getUsers(){
  return JSON.parse(localStorage.getItem("users")) || {};
}
function saveUsers(users){
  localStorage.setItem("users", JSON.stringify(users));
}

function getParentPin(){
  return localStorage.getItem("parentPin") || DEFAULT_PARENT_PIN;
}
function setParentPin(pin){
  localStorage.setItem("parentPin", pin);
}

/* ========== USER SETUP ========== */
function saveUserName(){
  const nameInput = document.getElementById("userNameInput");
  const ageInput = document.getElementById("userAgeInput");
  const phoneInput = document.getElementById("userPhoneInput");

  if(!nameInput || !ageInput || !phoneInput){
    alert("âŒ Input fields missing");
    return;
  }
  localStorage.setItem("userName", name);
currentUserName = name;

let currentUserName = localStorage.getItem("userName") || "Bachcha";

  if(
    nameInput.value.trim() === "" ||
    ageInput.value.trim() === "" ||
    phoneInput.value.trim() === ""
  ){
    alert("âš ï¸ Kripya sab details bhare");
    return;
  }

  // âœ… SAVE USER DATA
  localStorage.setItem("userName", nameInput.value.trim());
  localStorage.setItem("userAge", ageInput.value.trim());
  localStorage.setItem("userPhone", phoneInput.value.trim());

  // âœ… HIDE ENTRY POPUP
  const entryPopup = document.getElementById("entryPopup");
  if(entryPopup){
    entryPopup.style.display = "none";
  }

  // âœ… SHOW WELCOME TEXT
  const welcome = document.getElementById("welcomeUser");
  if(welcome){
    welcome.innerText = "ğŸ‘‹ Namaste, " + nameInput.value.trim();
    welcome.style.display = "block";
  }

  console.log("âœ… User data saved successfully");
}

function currentHour(){
  return new Date().getHours();
}


function loadUser(){
  try {
    const active = localStorage.getItem("activeUser");

    const popup = document.getElementById("entryPopup");
    const app = document.getElementById("app"); // ğŸ‘ˆ IMPORTANT

    if(active){
      currentUser = active;

      if(popup) popup.style.display = "none";
      if(app) app.style.display = "block";  // ğŸ”¥ THIS WAS MISSING

      const welcome = document.getElementById("welcomeUser");
      if(welcome){
        welcome.innerText = "ğŸ‘‹ Namaste, " + active;
      }

      updateScoreUI();
      updateLeaderboard();

    } else {
      if(popup) popup.style.display = "flex";
      if(app) app.style.display = "none";
    }

  } catch (e){
    console.error("loadUser crash:", e);
    alert("App load error â€“ console check karo");
  }
}



/* ========== SCORE SYSTEM (ONE SOURCE) ========== */
function getScore(){
  let users = getUsers();
  return users[currentUser]?.score || 0;
}
function addScore(points){
  let users = getUsers();
  if(!users[currentUser]) users[currentUser] = { score: 0 };
  users[currentUser].score += points;
  saveUsers(users);
  updateScoreUI();
}
function updateScoreUI(){
  document.getElementById("scoreBox").innerText =
    "â­ Score: " + getScore();
}

/* ========== TIME HELPER ========== */
function nowTime(){
  return new Date().toLocaleTimeString();
}

/* ========== PENDING TASKS ========== */
function addPending(taskName, points){
  pendingTasks.push({ name: taskName, points, time: nowTime() });
  alert("ğŸ•’ Task parent review ke liye pending hai");
}

/* ========== TASK FUNCTIONS ========== */
function doneWakeUp(){
  const h = currentHour();
  if(h < 4 || h >= 5){
    alert("âŒ Subah uthna sirf 4:00 â€“ 5:00 AM ke beech valid hai");
    return;
  }
  addPending("Subah Jaldi Uthna", 5);
}

let exSeconds = 30 * 60; // 30 minutes
let exInterval = null;

function startExercise(){
  if(exInterval) return;

  exInterval = setInterval(()=>{
    exSeconds--;
    updateExerciseUI();

    if(exSeconds <= 0){
      clearInterval(exInterval);
      exInterval = null;
      alert("ğŸƒâ€â™‚ï¸ Exercise poori ho gayi");
    }
  },1000);
}

function stopExercise(){
  clearInterval(exInterval);
  exInterval = null;
}

function updateExerciseUI(){
  const timerEl = document.getElementById("exerciseTimer");

  // â›” Parent Review open hai ya DOM me nahi hai
  if(!timerEl){
    return; // silently exit â€” no error
  }

  const m = Math.floor(exSeconds / 60);
  const s = exSeconds % 60;
  timerEl.innerText = `${m}:${s < 10 ? "0" : ""}${s}`;
}

function exerciseDone(){

  const h = currentHour();
  if(h >= 6){
    alert("âŒ Exercise 6:00 AM se pehle honi chahiye");
    return;
  }

  addPending("Exercise", 3);
  alert("âœ… Exercise mark ho gayi");
}

  
function skipExercise(){
  alert("âŒ Exercise skip");
}

 
function doneBath(){
  const h = currentHour();
  if(h >= 6){
    alert("âŒ Nahana 6:00 AM se pehle hona chahiye");
    return;
  }
  addPending("Nahana", 2);
}

function donePran(){
  const h = currentHour();
  if(h >= 5){
    alert("âŒ Pranayam 5:00 AM se pehle hona chahiye");
    return;
  }
  addPending("Pranayam", 4);
}
function doneMala(){
  const h = currentHour();
  if(h >= 7){
    alert("âŒ Mala jap 7:00 AM se pehle hona chahiye");
    return;
  }
  addPending("11 Mala Jap", 5);
}

let mounSeconds = 60 * 60; // ğŸ”¥ 1 ghanta = 3600 sec
let mounInterval = null;

function startMoun(){
  if(mounInterval) return; // already running

  const timerEl = document.getElementById("mounTimer");
  if(!timerEl){
    alert("Moun timer element missing");
    return;
  }

  timerEl.innerText = formatTime(mounSeconds);

  mounInterval = setInterval(() => {
    mounSeconds--;

    timerEl.innerText = formatTime(mounSeconds);

    if(mounSeconds <= 0){
      clearInterval(mounInterval);
      mounInterval = null;
      timerEl.innerText = "âœ… Moun Complete";

      // Moun complete â†’ pending for parent review
      addPending("Moun (1 Hour)", 3);
      alert("ğŸ™ Moun poora hua");
    }
  }, 1000);
}

function stopMoun(){
  clearInterval(mounInterval);
  mounInterval = null;
}

function formatTime(sec){
  const m = Math.floor(sec / 60);
  const s = sec % 60;
  return `${m}:${s < 10 ? "0" : ""}${s}`;
}

function doneSatsang(){
  addPending("Satsang Sunna", 4);
}


/* ========== PARENT PIN / REVIEW ========== */
function setParentPIN(pin){
  localStorage.setItem("parentPIN", pin);
}

function getParentPIN(){
  return localStorage.getItem("parentPIN");
}
 

function parentReview(){
  openParentReview();
}

function openParentReview(){

  const savedPin = localStorage.getItem("parentPIN");

  // first time reminder
  if(!savedPin){
    document.getElementById("pinReminderPopup").style.display = "flex";
    return;
  }

  const entered = prompt("ğŸ” Parent PIN dalo");
  if(entered !== savedPin){
    alert("âŒ Galat PIN");
    return;
  }

  if(pendingTasks.length === 0){
    alert("Aaj koi pending task nahi hai");
    return;
  }

  reviewIndex = 0;
  document.getElementById("parentPopup").style.display = "flex";
  showReviewTask();
}

  // PIN verify
  const entered = prompt("ğŸ” Parent PIN dalo");
  if(entered !== savedPin){
    alert("âŒ Galat PIN");
    return;
  }

  // open review popup
  const popup = document.getElementById("parentPopup");
  if(!popup){
    alert("Parent popup missing");
    return;
  }

  if(pendingTasks.length === 0){
    alert("Aaj koi pending task nahi hai");
    return;
  }

  reviewIndex = 0;
  popup.style.display = "flex";
  showReviewTask();


function verifyParentPIN(){
  const enteredPin = prompt("ğŸ” Parent PIN dalo");

  if(!enteredPin){
    alert("PIN cancel kar diya");
    return false;
  }

  if(enteredPin !== getParentPin()){
    alert("âŒ Galat PIN");
    return false;
  }

  return true;
}
function openPinSetup(){
  const reminder = document.getElementById("pinReminderPopup");
  const pinPopup = document.getElementById("changePinPopup");

  if(reminder) reminder.style.display = "none";
  if(pinPopup) pinPopup.style.display = "flex";
}

function closePinSetup(){
  const pinPopup = document.getElementById("changePinPopup");
  if(pinPopup) pinPopup.style.display = "none";
}

function saveParentPin(){
  const input = document.getElementById("newParentPin");

  if(!input || !input.value){
    alert("âš ï¸ Kripya PIN enter kare");
    return;
  }

  // âœ… YAHI PE PIN SAVE HOTA HAI
  localStorage.setItem("parentPIN", input.value);

  alert("âœ… Parent PIN save ho gaya");

  input.value = "";

  const pinPopup = document.getElementById("changePinPopup");
  if(pinPopup){
    pinPopup.style.display = "none";
  }
}
function openPinSetup(){
  closePinReminder();
  const pinPopup = document.getElementById("changePinPopup");
  if(pinPopup){
    pinPopup.style.display = "flex";
  }
}

function closePinSetup(){
  const pinPopup = document.getElementById("changePinPopup");
  if(pinPopup){
    pinPopup.style.display = "none";
  }
}

function closePinReminder(){
  const reminder = document.getElementById("pinReminderPopup");
  if(reminder){
    reminder.style.display = "none";
  }
}

function saveParentPin(){
  const input = document.getElementById("newParentPin");

  if(!input || input.value.length < 4){
    alert("âš ï¸ Kripya 4 digit PIN dale");
    return;
  }

  localStorage.setItem("parentPIN", input.value);
  alert("âœ… Parent PIN save ho gaya");

  input.value = "";
  closePinSetup();
}


  reviewIndex = 0;
  const p = document.getElementById("parentPopup");
  if(!p){
    alert("Parent popup missing");
  }

  p.style.display = "flex";
  showReviewTask();



function showReviewTask(){
  if(reviewIndex >= pendingTasks.length){
    pendingTasks = [];
    document.getElementById("parentPopup").style.display = "none";
    updateLeaderboard();
    alert("âœ… Parent review complete");
    return;
  }

  const t = pendingTasks[reviewIndex];
  document.getElementById("reviewTaskText").innerText =
    `${t.name} (${t.time})`;
}

function approveCurrent(){
  const task = pendingTasks[reviewIndex];
  addScore(task.points);
  reviewIndex++;
  showReviewTask();
}

function rejectCurrent(){

  const name =
    localStorage.getItem("userName") || "Bachcha";

  // âŒ 2 score penalty
  let users = getUsers();
  if(!users[currentUser]) users[currentUser] = { score: 0 };

  users[currentUser].score -= 2;
  if(users[currentUser].score < 0)
    users[currentUser].score = 0;

  saveUsers(users);
  updateScoreUI();

  alert(`ğŸ˜  ${name} aapne jhooth bola!\nâŒ 2 score minus honge`);

  reviewIndex++;
  showReviewTask();
}

let reviewManuallyOpened = false;


/* ========== CHANGE PARENT PIN ========== */
function changeParentPin(){
  const oldPin = prompt("Purana Parent PIN dalo");
  if(oldPin !== getParentPin()){
    alert("âŒ Galat PIN");
    return;
  }
  const newPin = prompt("Naya Parent PIN dalo (min 4 digit)");
  if(!newPin || newPin.length < 4){
    alert("PIN kam se kam 4 digit ka hona chahiye");
    return;
  }
  setParentPin(newPin);
  alert("âœ… Parent PIN change ho gaya");
}
function closePinReminder(){
  document.getElementById("pinReminderPopup").style.display = "none";
}

function openPinSetup(){
  // close reminder safely
  const reminder = document.getElementById("pinReminderPopup");
  if(reminder) reminder.style.display = "none";

  // close parent review popup if open
  const parentPopup = document.getElementById("parentPopup");
  if(parentPopup) parentPopup.style.display = "none";

  // open PIN setup popup (âœ… correct ID)
  const pinPopup = document.getElementById("changePinPopup");
  if(pinPopup){
    pinPopup.style.display = "flex";
  }else{
    alert("âŒ PIN setup popup missing");
  }
}


function updateLeaderboard(){
  const lb = document.getElementById("leaderboard");
  if(!lb){
    console.warn("Leaderboard element missing");
    return;
  }

  let users = JSON.parse(localStorage.getItem("users")) || {};

  let arr = Object.entries(users)
    .sort((a,b)=>b[1].score - a[1].score);

  if(arr.length === 0){
    lb.innerHTML = "<li>No data yet</li>";
    return;
  }

  let html = "";
  arr.forEach((u,i)=>{
    html += `<li>${i+1}. ${u[0]} â€” â­ ${u[1].score}</li>`;
  });

  lb.innerHTML = html;
}
function updateLeaderboard(){
  const lb = document.getElementById("leaderboard");
  if(!lb) return;

  let users = JSON.parse(localStorage.getItem("users")) || {};
  let list = Object.entries(users)
    .sort((a,b)=>b[1].score - a[1].score);

  if(list.length === 0){
    lb.innerHTML = "<li>No data yet</li>";
    return;
  }

  lb.innerHTML = list
    .map((u,i)=>`${i+1}. ${u[0]} â€” â­ ${u[1].score}`)
    .join("<br>");
}
function skipTask(msgId, nextBtnId){
  const msg = document.getElementById(msgId);
  if(msg) msg.innerText = "âŒ Skip kiya";

  if(nextBtnId){
    const btn = document.getElementById(nextBtnId);
    if(btn) btn.disabled = false;
  }
}
function parentReview(){
  openParentReview();
}




/* ========== INIT ========== */
window.onload = loadUser;

</script>
</body>
</html>
