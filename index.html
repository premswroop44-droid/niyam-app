<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Niyam App</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<link rel="manifest" href="manifest.json">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#4f46e5">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Niyam App">


<style>
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:#eef2f7;
  display:flex;
  justify-content:center;
}
.app{
  max-width:390px;
  width:100%;
  padding:20px;
  text-align:center;
}
.wallet{
  background:#fff;
  padding:12px;
  border-radius:12px;
  font-weight:600;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
  margin-bottom:15px;
}
.card{
  background:#fff;
  border-radius:16px;
  padding:18px;
  margin-bottom:15px;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
}
.title{font-size:18px;font-weight:600;}
.time{font-size:14px;color:#666;margin:6px 0;}
button{
  width:100%;
  padding:11px;
  border:none;
  border-radius:10px;
  background:#4f46e5;
  color:#fff;
  margin-top:8px;
  cursor:pointer;
}
button.red{background:#ef4444;}
button.green{background:#16a34a;}
button:disabled{background:#aaa;}
.msg{margin-top:8px;font-weight:600;}
.toggle{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-bottom:15px;
}
#reviewOverlay{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.6);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:9999;
}

#reviewBox{
  background:#fff;
  width:300px;
  padding:20px;
  border-radius:14px;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,0.3);
}

.reviewBtns{
  display:flex;
  gap:10px;
  margin-top:20px;
}

.reviewBtns button{
  flex:1;
  padding:10px;
  border:none;
  border-radius:10px;
  font-size:15px;
  cursor:pointer;
}

.reviewBtns .yes{
  background:#16a34a;
  color:white;
}

.reviewBtns .no{
  background:#dc2626;
  color:white;
}
#calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:5px;
  margin-top:10px;
}

.day{
  border:1px solid #ddd;
  border-radius:6px;
  padding:5px;
  font-size:11px;
  background:#f9fafb;
}

.day strong{
  display:block;
  font-size:12px;
  margin-bottom:3px;
}

.done{ color:green; }
.skip{ color:red; }
/* ===============================
   MOBILE FIX (PHONE VIEW)
================================ */
@media (max-width: 600px){

  body{
    font-size:14px;
  }

  .app-container{
    padding:10px;
  }

  .main-layout{
    display:block;   /* desktop grid hat jaayega */
  }

  .controls,
  .reports{
    width:100%;
  }

  .card{
    margin-bottom:12px;
  }

  button{
    width:100%;      /* buttons full-width */
    font-size:15px;
  }

  .wallet{
    font-size:16px;
  }

  #calendar{
    grid-template-columns: repeat(7, 1fr);
    gap:4px;
  }

  .day{
    font-size:10px;
    min-height:70px;
  }
}
/* ===== MOBILE FIX ===== */
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  overflow-x: hidden;   /* üëà sabse important */
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
}
/* ===== PHONE VIEW ===== */
@media (max-width: 768px){

  .main-layout,
  .container,
  .dashboard {
    display: block !important;  /* ek ke niche ek */
    width: 100%;
  }

  .card {
    width: 100%;
    margin: 10px 0;
    box-sizing: border-box;
  }

  button {
    width: 100%;
    font-size: 16px;
  }

  img, svg, i {
    max-width: 100%;
    height: auto;
  }

}
/* ===== FINAL MOBILE + DESKTOP FIX ===== */

* {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow-x: hidden;   /* üî• horizontal scroll kill */
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
}

#app-root {
  width: 100%;
  max-width: 100vw;     /* üî• important */
  padding: 10px;
}

/* Main layout */
.main-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  width: 100%;
}

/* Cards */
.card {
  width: 100%;
  max-width: 100%;
  overflow: hidden;
}

/* Monthly report calendar */
#calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  width: 100%;
}

#calendar button,
#calendar div {
  width: 100%;
  min-width: 0;
}

/* Buttons */
button {
  width: 100%;
  max-width: 100%;
}

/* ===== PHONE VIEW ===== */
@media (max-width: 768px){

  .main-layout {
    grid-template-columns: 1fr;  /* üî• ek ke niche ek */
  }

  #calendar {
    grid-template-columns: repeat(7, 1fr);
  }

}
body {
  max-width: 100vw;
  overflow-x: hidden;
  touch-action: manipulation;
}
@media screen and (max-width: 1000px) {
  * {
    max-width: 100% !important;
  }
}
/* ===== ENTRY POPUP (FULL PAGE FEEL) ===== */

.entry-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.55);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.entry-popup {
  background: #ffffff;
  width: 100%;
  max-width: 420px;
  height: 90vh;              /* üî• height badi */
  border-radius: 18px;
  padding: 25px;
  box-shadow: 0 15px 30px rgba(0,0,0,0.25);
  display: flex;
  flex-direction: column;
  justify-content: center;
  text-align: center;
}

.entry-popup h2 {
  margin-bottom: 8px;
}

.entry-popup p {
  color: #666;
  font-size: 14px;
  margin-bottom: 25px;
}

.entry-popup input {
  width: 100%;
  padding: 14px;
  margin-bottom: 16px;
  font-size: 16px;
  border-radius: 12px;
  border: 1px solid #ccc;
}

.entry-popup input:focus {
  outline: none;
  border-color: #4facfe;
}

.entry-popup button {
  margin-top: 10px;
  padding: 14px;
  font-size: 17px;
  border-radius: 14px;
  border: none;
  background: #4facfe;
  color: white;
  font-weight: bold;
}
/* ========= MOBILE MODE (‚â§ 400px) ========= */
@media (max-width: 400px){

  /* poora layout ek column */
  .main-layout,
  .dashboard,
  .container,
  .row {
    display: block !important;
    width: 100% !important;
  }

  /* side panels hide */
  .right-panel,
  .monthly-panel,
  .storage-panel {
    display: none !important;
  }

  /* cards full width */
  .card {
    width: 100% !important;
    margin: 10px 0 !important;
  }

  /* buttons mobile friendly */
  button {
    width: 100% !important;
    font-size: 16px;
  }

  /* header center */
  header,
  .header {
    text-align: center;
  }

}
.btn-mobile {
  display: none;
  margin: 10px 0;
  padding: 12px;
  border-radius: 12px;
  background: #4facfe;
  color: white;
  font-size: 16px;
  border: none;
}

/* mobile me hi dikhe */
@media (max-width: 400px){
  .btn-mobile {
    display: block;
  }
}
/* ========= FORCE MOBILE HIDE (‚â§ 400px) ========= */
@media (max-width: 400px){


}
@media (max-width: 400px){

  button {
    width: auto !important;     /* üî• full width band */
    min-width: 160px;
    padding: 10px 16px;
    font-size: 14px;
    border-radius: 10px;
    display: block;
    margin: 8px auto;           /* center */
  }

}
/* ===== MOBILE HARD FIX ===== */
@media (max-width: 400px){

  body {
    overflow-x: hidden;
  }

  

  /* Layout collapse to single column */
  .main-layout {
    display: block !important;
    width: 100% !important;
  }
}
/* ===== FORCE SCROLL FIX ===== */
html, body {
  height: auto !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
}

/* cards ke andar bhi scroll allow */
.card {
  overflow: visible !important;
}
/* overlay click block fix */
.entry-overlay[style*="display: none"],
#parentPopup[style*="display: none"] {
  pointer-events: none;
}
.entry-overlay,
#parentPopup {
  pointer-events: auto;
}
/* ===== Parent section always visible ===== */
#parentSection,
.parent-section {
  display: block !important;
}
@media (max-width: 420px) {

  .main-layout {
    display: flex !important;
    flex-direction: column !important;
    width: 100%;
  }


  /* buttons normal size */
  button {
    width: auto;
    min-width: 140px;
    margin: 8px auto;
  }
}
/* ===== FORCE LEADERBOARD SHOW ===== */
#leaderboard {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  position: relative;
  z-index: 1;
}
html, body {
  overflow-x: hidden;
  overflow-y: auto;
}
/* ===== POPUP OVERLAY ===== */
.popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.45);
  display: none;              /* üî• by default hidden */
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

/* popup card */
.popup-card {
  width: 90%;
  max-width: 400px;
  height: 90vh;               /* page feel */
  background: white;
  border-radius: 18px;
  padding: 24px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

/* inputs */
.popup-card input {
  margin-bottom: 14px;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid #ccc;
}

/* button */
.popup-card button {
  margin-top: 10px;
  padding: 14px;
  border-radius: 12px;
  border: none;
  background: #4facfe;
  color: #fff;
}

/* SCROLL FIX */
html, body {
  overflow-y: auto !important;
}


</style>
</head>

<body>


<div class="app">

<h2>üì± Niyam App</h2>

<div id="scoreBox" class="card">
  ‚≠ê Score: 0
</div>
<div class="card">
  <h3>üèÜ Leaderboard</h3>
  <ul id="leaderboard"></ul>
</div>

<!-- üîê Parent Review Button -->

<div class="card">
  <div class="title">üë®‚Äçüë©‚Äçüë¶ Parent Section</div>

  <button onclick="parentReview()">üîê Parent Daily Review</button>

  <button onclick="changeParentPin()">
    üîÅ Change Parent PIN
  </button>

  <div class="time">(Sirf parent ke liye)</div>
</div>


<!-- ‚òÄÔ∏è SUNDAY TOGGLE -->
<div class="toggle">
<button class="green" onclick="setSunday(true)">‚òÄÔ∏è Sunday</button>
<button onclick="setSunday(false)">üè´ Normal Day</button>
</div>

<!-- üåÖ SUBAH JALDI UTHNA -->
<div class="card">
<div class="title">üåÖ Subah Jaldi Uthna</div>
<div class="time">(Allowed: 4:00 ‚Äì 5:00 AM)</div>
<button onclick="doneWakeUp()">‚úî Tick</button>
<div class="msg" id="wakeMsg"></div>
<button class="red" onclick="skipTask('wakeMsg','exStartBtn')">‚ùå Nahi Kiya</button>
</div>

<!-- üèÉ EXERCISE -->
<div class="card">
<div class="title">üèÉ Exercise</div>
<div class="time">(30 minute compulsory)</div>

<div id="exTimer">‚è≥ 30:00</div>
<button onclick="startExercise()">‚ñ∂Ô∏è Start</button>
<button class="red" onclick="stopExercise()">‚è∏Ô∏è Stop</button>
<button id="exTick" onclick="doneExercise()" disabled>‚úî Tick</button>
<div class="msg" id="exMsg"></div>
<button class="red"
  onclick="skipTask('exMsg','bathBtn')">
‚ùå Nahi Kiya
</button>
</button>
</div>

<!-- üöø NAHANA -->
<div class="card">
<div class="title">üöø Nahana</div>
<button id="bathBtn" onclick="doneBath()" disabled>‚úî Tick</button>
<div class="msg" id="bathMsg"></div>
<button class="red"
  onclick="skipTask('bathMsg','pranBtn')">
‚ùå Nahi Kiya
</button>
</div>

<!-- üßò PRANAYAMA -->
<div class="card">
<div class="title">üßò Pranayama</div>
<div class="time">(Allowed:before 5:00 AM)</div>
<button id="pranBtn" onclick="donePran()" disabled>‚úî Tick</button>
<div class="msg" id="pranMsg"></div>
<button class="red"
  onclick="skipTask('pranMsg','malaBtn')">
‚ùå Nahi Kiya
</button>
</div>

<!-- üìø MALA -->
<div class="card">
<div class="title">üìø 11 Mala Jap</div>
<button id="malaBtn" onclick="doneMala()" disabled>‚úî Tick</button>
<div class="msg" id="malaMsg"></div>
<button class="red"
  onclick="skipTask('malaMsg','schoolBtn')">
‚ùå Nahi Kiya
</button>
</div>

<!-- üìø MALA -->
<div class="card">
<div class="title">satsang sunna</div>
<button onclick="doneSatsang()" disabled>‚úî Tick</button>
<div class="msg" id="malaMsg"></div>
<button class="red"
  onclick="skipTask('doneSatsang','schoolBtn')">
‚ùå Nahi Kiya
</button>
</div>


<!-- monun-->
<div class="card">
  <h3>ü§´ Moun (Chup Rahna)</h3>

  <div id="mounTimer">‚è≥ 60:00</div>

  <button id="mounStart" onclick="startMoun()">
    ‚ñ∂ Start Moun
  </button>

  <button id="mounDone" onclick="doneMoun()" disabled>
    ‚úî Moun Complete
  </button>

  <div id="mounMsg"></div>
</div>


</div>
<!-- üîê Parent Review Popup -->
<div id="parentPopup" style="display:none;">
  <div id="reviewBox">
    <h3>üë®‚Äçüë©‚Äçüë¶ Parent Review</h3>
    <p id="reviewText"></p>
<button onclick="openParentReview()">üîê Parent Daily Review</button>

    <div class="reviewBtns">
      <button class="yes" onclick="approveCurrent()">‚úÖ Haan</button>
      <button class="no" onclick="rejectCurrent()">‚ùå Nahi</button>
    </div>
  </div>
</div>
 <div id="entryPopup" class="popup-overlay" style="display:flex">
  <div class="popup-card">
    <h2>üëã Welcome</h2>
    <p>Apni basic details bhare</p>

    <input id="userNameInput" placeholder="Full Name">
    <input id="userAgeInput" placeholder="Age">
    <input id="userPhoneInput" placeholder="Phone Number">

    <button onclick="saveUserName()">Continue</button>
  </div>
</div>

  <div id="entryPopup" class="entry-overlay" style="display:none">


<h2 id="welcomeUser" style="display:none"></h2>
</div>
</div>
  
<script>
  /*************************************************
 * NIYAM APP ‚Äì FULL FINAL JS
 *************************************************/

/* ========== CONFIG ========== */
const DEFAULT_PARENT_PIN = "1234";

/* ========== GLOBALS ========== */
let currentUser = null;
let pendingTasks = [];
let reviewIndex = 0;

/* ========== STORAGE HELPERS ========== */
function getUsers(){
  return JSON.parse(localStorage.getItem("users")) || {};
}
function saveUsers(users){
  localStorage.setItem("users", JSON.stringify(users));
}

function getParentPin(){
  return localStorage.getItem("parentPin") || DEFAULT_PARENT_PIN;
}
function setParentPin(pin){
  localStorage.setItem("parentPin", pin);
}

/* ========== USER SETUP ========== */
function saveUserName(){
  const name = document.getElementById("userNameInput")?.value?.trim();
  const age = document.getElementById("userAgeInput")?.value?.trim();
  const phone = document.getElementById("userPhoneInput")?.value?.trim();

  if(!name || !age || !phone){
    alert("Please fill all details");
    return;
  }

  currentUser = name;
  localStorage.setItem("activeUser", name);

  let users = JSON.parse(localStorage.getItem("users")) || {};
  if(!users[name]){
    users[name] = { score: 0, age, phone };
    localStorage.setItem("users", JSON.stringify(users));
  }

  const popup = document.getElementById("entryPopup");
  if(popup){
    popup.style.display = "none";
  }

  const welcome = document.getElementById("welcomeUser");
  if(welcome){
    welcome.innerText = "üëã Namaste, " + name;
  }

  updateScoreUI();
  updateLeaderboard();
}

function loadUser(){
  try {
    const active = localStorage.getItem("activeUser");

    const popup = document.getElementById("entryPopup");
    const app = document.getElementById("app"); // üëà IMPORTANT

    if(active){
      currentUser = active;

      if(popup) popup.style.display = "none";
      if(app) app.style.display = "block";  // üî• THIS WAS MISSING

      const welcome = document.getElementById("welcomeUser");
      if(welcome){
        welcome.innerText = "üëã Namaste, " + active;
      }

      updateScoreUI();
      updateLeaderboard();

    } else {
      if(popup) popup.style.display = "flex";
      if(app) app.style.display = "none";
    }

  } catch (e){
    console.error("loadUser crash:", e);
    alert("App load error ‚Äì console check karo");
  }
}


/* ========== SCORE SYSTEM (ONE SOURCE) ========== */
function getScore(){
  let users = getUsers();
  return users[currentUser]?.score || 0;
}
function addScore(points){
  let users = getUsers();
  if(!users[currentUser]) users[currentUser] = { score: 0 };
  users[currentUser].score += points;
  saveUsers(users);
  updateScoreUI();
}
function updateScoreUI(){
  document.getElementById("scoreBox").innerText =
    "‚≠ê Score: " + getScore();
}

/* ========== TIME HELPER ========== */
function nowTime(){
  return new Date().toLocaleTimeString();
}

/* ========== PENDING TASKS ========== */
function addPending(taskName, points){
  pendingTasks.push({ name: taskName, points, time: nowTime() });
  alert("üïí Task parent review ke liye pending hai");
}

/* ========== TASK FUNCTIONS ========== */
function doneWakeUp(){ addPending("Subah Jaldi Uthna", 5); }
function doneExercise(){ addPending("Exercise", 3); }
function doneBath(){ addPending("Nahana", 2); }
function donePranayam(){ addPending("Pranayam", 4); }
function doneMala(){ addPending("11 Mala Jap", 5); }
function doneMoun(){ addPending("Moun (Chup Rahna)", 3); } // no repeat popup
function doneSatsang(){
  addPending("Satsang Sunna", 4);
}


/* ========== PARENT PIN / REVIEW ========== */


function openParentReview(){
  if(pendingTasks.length === 0){
    alert("Koi pending task nahi");
    return;
  }

  const pin = prompt("üîê Parent PIN dalo");
  if(pin !== getParentPin()){
    alert("‚ùå Galat PIN");
    return;
  }

  reviewIndex = 0;
  const p = document.getElementById("parentPopup");
  if(!p){
    alert("Parent popup missing");
    return;
  }

  p.style.display = "flex";
  showReviewTask();
}


function showReviewTask(){
  if(reviewIndex >= pendingTasks.length){
    pendingTasks = [];
    document.getElementById("parentPopup").style.display = "none";
    updateLeaderboard();
    alert("‚úÖ Parent review complete");
    return;
  }
  const t = pendingTasks[reviewIndex];
  document.getElementById("parentTaskName").innerText =
    t.name + " (" + t.time + ")";
}

function approveTask(){
  addScore(pendingTasks[reviewIndex].points);
  reviewIndex++;
  showReviewTask();
}

function rejectTask(){
  let users = getUsers();
  users[currentUser].score = Math.max(0, users[currentUser].score - 2);
  saveUsers(users);
  updateScoreUI();
  alert("‚ùå apne Jhoot bola ‚Äì 2 score minus");
  reviewIndex++;
  showReviewTask();
}
document.getElementById("parentPopup").style.display = "none";




/* ========== CHANGE PARENT PIN ========== */
function changeParentPin(){
  const oldPin = prompt("Purana Parent PIN dalo");
  if(oldPin !== getParentPin()){
    alert("‚ùå Galat PIN");
    return;
  }
  const newPin = prompt("Naya Parent PIN dalo (min 4 digit)");
  if(!newPin || newPin.length < 4){
    alert("PIN kam se kam 4 digit ka hona chahiye");
    return;
  }
  setParentPin(newPin);
  alert("‚úÖ Parent PIN change ho gaya");
}

function updateLeaderboard(){
  const lb = document.getElementById("leaderboard");
  if(!lb){
    console.warn("Leaderboard element missing");
    return;
  }

  let users = JSON.parse(localStorage.getItem("users")) || {};

  let arr = Object.entries(users)
    .sort((a,b)=>b[1].score - a[1].score);

  if(arr.length === 0){
    lb.innerHTML = "<li>No data yet</li>";
    return;
  }

  let html = "";
  arr.forEach((u,i)=>{
    html += `<li>${i+1}. ${u[0]} ‚Äî ‚≠ê ${u[1].score}</li>`;
  });

  lb.innerHTML = html;
}
function updateLeaderboard(){
  const lb = document.getElementById("leaderboard");
  if(!lb) return;

  let users = JSON.parse(localStorage.getItem("users")) || {};
  let list = Object.entries(users)
    .sort((a,b)=>b[1].score - a[1].score);

  if(list.length === 0){
    lb.innerHTML = "<li>No data yet</li>";
    return;
  }

  lb.innerHTML = list
    .map((u,i)=>`${i+1}. ${u[0]} ‚Äî ‚≠ê ${u[1].score}`)
    .join("<br>");
}
function skipTask(msgId, nextBtnId){
  const msg = document.getElementById(msgId);
  if(msg) msg.innerText = "‚ùå Skip kiya";

  if(nextBtnId){
    const btn = document.getElementById(nextBtnId);
    if(btn) btn.disabled = false;
  }
}



/* ========== INIT ========== */
window.onload = loadUser;

</script>
</body>
</html>
